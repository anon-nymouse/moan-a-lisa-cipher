<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>StegoEngine | Secure Share</title>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background: #f8fafc; color: #1e293b; display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .container { width: 100%; max-width: 600px; }
        .card { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin-bottom: 2rem; border: 1px solid #e2e8f0; }
        h2 { margin: 0 0 1.5rem 0; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem; }
        input[type="text"] { width: 100%; padding: 0.75rem; margin: 1rem 0; border: 1px solid #cbd5e1; border-radius: 0.5rem; box-sizing: border-box; }
        button { width: 100%; background: #0f172a; color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; }
        .share-box { display: none; margin-top: 1.5rem; padding: 1rem; background: #f0fdf4; border: 1px dashed #10b981; border-radius: 0.5rem; word-break: break-all; }
        .link-text { font-family: monospace; font-size: 0.9rem; color: #059669; }
        .status-msg { font-size: 0.875rem; color: #64748b; margin-top: 0.5rem; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Encode & Share</h2>
        <p>Image (Optional): <input type="file" id="encFile" accept="image/png"></p>
        <input type="text" id="encMsg" placeholder="Enter secret message...">
        <div id="encStatus" class="status-msg"></div>
        <button onclick="handleEncode()">Generate One-Time Link</button>

        <div id="shareBox" class="share-box">
            <strong>One-Time Shareable Link:</strong><br>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                <span id="shareUrl" class="link-text" style="flex-grow: 1; background: white; padding: 5px; border-radius: 4px; border: 1px solid #d1fae5;"></span>
                <button id="copyBtn" onclick="copyLink()" style="width: auto; padding: 5px 15px; font-size: 0.8rem; background: #10b981;">Copy</button>
            </div>
            <p style="font-size: 0.75rem; color: #666; margin-top: 10px;">Warning: This link will work only ONCE.</p>
        </div>

    <div class="card">
        <h2>Decode</h2>
        <input type="file" id="decFile" accept="image/png">
        <div id="decStatus" class="status-msg"></div>
        <button onclick="handleDecode()" style="margin-top: 1rem;">Extract Message</button>
        <div id="decResult" style="display:none; margin-top:1rem; font-weight:bold; color:#0f172a;"></div>
    </div>
</div>

<script>
    async function handleEncode() {
        const msg = document.getElementById('encMsg').value;
        const file = document.getElementById('encFile').files[0];
        const status = document.getElementById('encStatus');
        const shareBox = document.getElementById('shareBox');

        if(!msg) return alert("Message required");
        status.innerText = "C++ Engine encoding...";
        shareBox.style.display = 'none';

        const fd = new FormData();
        fd.append("message", msg);
        if(file) fd.append("file", file);

        try {
            const res = await fetch('/hide', { method: 'POST', body: fd });
            const data = await res.json();

            if(res.ok) {
                document.getElementById('shareUrl').innerText = data.share_url;
                shareBox.style.display = 'block';
                status.innerText = "Done!";
            } else {
                status.innerText = "Failed to encode.";
            }
        } catch (e) {
            status.innerText = "Server Error.";
        }
    }

    async function handleDecode() {
        const file = document.getElementById('decFile').files[0];
        if(!file) return alert("Select a file");

        const fd = new FormData();
        fd.append("file", file);

        try {
            const res = await fetch('/extract', { method: 'POST', body: fd });
            const data = await res.json();
            const resultDiv = document.getElementById('decResult');
            resultDiv.innerText = res.ok ? "Secret: " + data.message : "Error: " + data.detail;
            resultDiv.style.display = 'block';
        } catch (e) {
            alert("Error connecting to server");
        }
    }
    function copyLink() {
        const linkText = document.getElementById('shareUrl').innerText;
        const copyBtn = document.getElementById('copyBtn');
    
        if (!linkText) return;
    
        // Use the Clipboard API
        navigator.clipboard.writeText(linkText).then(() => {
            // Visual Feedback
            const originalText = copyBtn.innerText;
            const originalBg = copyBtn.style.background;
    
            copyBtn.innerText = "Copied!";
            copyBtn.style.background = "#059669"; // Darker green
    
            // Reset button after 2 seconds
            setTimeout(() => {
                copyBtn.innerText = originalText;
                copyBtn.style.background = originalBg;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert("Could not copy link. Please select and copy manually.");
        });
    }
</script>
</body>
</html>

